"use strict";(self.webpackChunkweb_ctf=self.webpackChunkweb_ctf||[]).push([[232],{9138:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var t=n(5893),i=n(1151);const o={},r="Stolen licenses (300 points)",c={id:"writeups/Syskron/2020/stolen_licenses",title:"Stolen licenses (300 points)",description:"Description",source:"@site/docs/writeups/Syskron/2020/stolen_licenses.md",sourceDirName:"writeups/Syskron/2020",slug:"/writeups/Syskron/2020/stolen_licenses",permalink:"/docs/docs/writeups/Syskron/2020/stolen_licenses",draft:!1,unlisted:!1,editUrl:"https://github.com/boyney123/eventcatalog/edit/master/website/docs/writeups/Syskron/2020/stolen_licenses.md",tags:[],version:"current",lastUpdatedBy:"kostezy",frontMatter:{},sidebar:"writeups",previous:{title:"Security.txt (200 points)",permalink:"/docs/docs/writeups/Syskron/2020/security_txt"},next:{title:"Biggest Lowest (50 points)",permalink:"/docs/docs/writeups/X-MAS/2020/biggest_lowest"}},a={},l=[{value:"Description",id:"description",level:2},{value:"Solution",id:"solution",level:2}];function d(e){const s=Object.assign({h1:"h1",h2:"h2",p:"p",a:"a",pre:"pre",code:"code",img:"img",strong:"strong"},(0,i.ah)(),e.components);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"stolen-licenses-300-points",children:"Stolen licenses (300 points)"}),"\n",(0,t.jsx)(s.h2,{id:"description",children:"Description"}),"\n",(0,t.jsx)(s.p,{children:"We found another file on the dark net! It seems that cyber criminals stole some of our license keys and put them up for sale."}),"\n",(0,t.jsxs)(s.p,{children:["We tracked down a ZIP file at ",(0,t.jsx)(s.a,{href:"https://use01.thegood.cloud/s/ncWkZGcskTEDpGe",children:"https://use01.thegood.cloud/s/ncWkZGcskTEDpGe"})," (password for download syskron.CTF2020)."]}),"\n",(0,t.jsx)(s.p,{children:"We don't know the password of the ZIP file, but maybe it is weak encryption that can be easily cracked. If you find any valid license key, let us know."}),"\n",(0,t.jsx)(s.h2,{id:"solution",children:"Solution"}),"\n",(0,t.jsx)(s.p,{children:"The archive consists of 1000 photos, but first you need to find a password for the zip archive. For this, we will use fcrackzip. First of all, let's try the rockyou wordlist."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ fcrackzip -u -D -p ./rockyou.txt ./licenses.zip\n"})}),"\n",(0,t.jsxs)(s.p,{children:["To no avail, then we will use a 15GB wordlist ",(0,t.jsx)(s.a,{href:"https://crackstation.net/crackstation-wordlist-password-cracking-dictionary.htm",children:"(link to wordlist)"}),".\nIt will take much longer (+-15 minuts for me), but during this time you can do other tasks."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ fcrackzip -u -D -p ./crackstation.txt/realuniq.lst ./licenses.zip\n\n\nPASSWORD FOUND!!!!: pw == nosocomephobia\n"})}),"\n",(0,t.jsx)(s.p,{children:"Okay, now we have a password, you can see what kind of photos there are."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:n(3898).Z+"",width:"1000",height:"660"})}),"\n",(0,t.jsxs)(s.p,{children:["We need to find a valid key. Referring to the first tasks, where there was a mention of the Luhn algorithm for checking the validity, we will use this algorithm to check the keys, but first we need to get a list of keys. For this we will use the ",(0,t.jsx)(s.strong,{children:"tesseract"})]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ tesseract B999582-0001.png stdout\nDetected 10 diacritics\nSW serial number\n\nactivation key\n\nonly valid if purchased together with a machine\n"})}),"\n",(0,t.jsx)(s.p,{children:"Tesseract does not see the key. I decided to hardcode and change the colors of the pictures so that the tesseract can see the keys. For this I used python and the OpenCV library."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-python",children:"import cv2\n\nfor i in range(1, 1001):\n    img = 'B999582-{0:04}.png'.format(i)\n    src = cv2.imread(img, cv2.IMREAD_UNCHANGED)\n    green_channel = src[:,:,2]\n    cv2.imwrite('res/{0:04}.png'.format(i), green_channel)\n"})}),"\n",(0,t.jsx)(s.p,{children:"Now the pictures look like this:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{src:n(5545).Z+"",width:"1000",height:"660"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ tesseract res/0001.png stdout\nWarning: Invalid resolution 0 dpi. Using 70 instead.\nEstimating resolution as 333\noe eee\n\nSW serial number\n\nB999582-0001\n\nactivation key\n\n78121994415279564775\n\nonly valid if purchased together with a machine\n"})}),"\n",(0,t.jsx)(s.p,{children:"Works fine. Let's write a small bash script to get a list of keys"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ for i in {0001..1000}; do tesseract res/$i.png stdout | grep -x -E '[0-9]{20}'; done >> keys.txt\n"})}),"\n",(0,t.jsx)(s.p,{children:"Now that we have a list of all the keys, I wrote a script on node.js that checks the keys using the above algorithm"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-javascript",children:"const Luhr = require('luhn-js');\nconst fs = require('fs');\n\nconst data = fs.readFileSync('./keys.txt', 'utf-8').split('\\n');\n\ndata.forEach(key => Luhr.isValid(key) ? console.log(key) : null);\n"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-shell",children:"$ node valid.js\n78124512846934984669\n"})}),"\n",(0,t.jsx)(s.p,{children:"Flag: 78124512846934984669"})]})}const h=function(e={}){const{wrapper:s}=Object.assign({},(0,i.ah)(),e.components);return s?(0,t.jsx)(s,Object.assign({},e,{children:(0,t.jsx)(d,e)})):d(e)}},5545:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/0001-50b38344a2d699e62b573a0ec00f194c.png"},3898:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/B999582-0001-6733980d17544e6f7a6fb09711f1a1c1.png"},1151:(e,s,n)=>{n.d(s,{Zo:()=>c,ah:()=>o});var t=n(7294);const i=t.createContext({});function o(e){const s=t.useContext(i);return t.useMemo((()=>"function"==typeof e?e(s):{...s,...e}),[s,e])}const r={};function c({components:e,children:s,disableParentContext:n}){let c;return c=n?"function"==typeof e?e({}):e||r:o(e),t.createElement(i.Provider,{value:c},s)}}}]);